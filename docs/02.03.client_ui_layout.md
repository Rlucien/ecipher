# ecipher å®¢æˆ·ç«¯ç•Œé¢æ¶æ„è®¾è®¡

## 1. ç•Œé¢å¸ƒå±€ç»“æ„

### 1.1 æ•´ä½“å¸ƒå±€

æ•´ä¸ªå®¢æˆ·ç«¯ç•Œé¢ç”± MenuBarã€SideBarã€Body å’Œ StatusBar å››ä¸ªéƒ¨åˆ†ç»„æˆï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             MenuBar                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚                                               â”‚
â”‚     SideBar     â”‚                     Body                      â”‚
â”‚                 â”‚                                               â”‚
â”‚  SideItem:      â”‚      Display according to the SideItem:       â”‚
â”‚                 â”‚                                               â”‚
â”‚  - Home         â”‚        - HomePage                             â”‚
â”‚  - KeyManage    â”‚        - KeyManagePage                        â”‚
â”‚  - Certificate  â”‚        - CertificatePage                      â”‚
â”‚  - Symmetric    â”‚        - SymmetricPage                        â”‚
â”‚  - Asymmetric   â”‚        - AsymmetricPage                       â”‚
â”‚  - Digest       â”‚        - DigestPage                           â”‚
â”‚  - Settings     â”‚        - SettingsPage                         â”‚
â”‚  - About        â”‚        - AboutPage                            â”‚
â”‚                 â”‚                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            StatusBar                            â”‚
â”‚  Link Status | User | Tip | Time                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. ç•Œé¢ç»„ä»¶

### 2.1 MenuBar(å·¥å…·æ )

### 2.2 SideBar(ä¾§è¾¹æ )

### 2.2 Body(å†…å®¹é¡µ)

### 2.2 StatusBar(çŠ¶æ€æ )

## 2. ç»„ä»¶

### 2.1 å¸ƒå±€å®ç° (app.rs)

```rust
use iced::{Application, Command, Element, Settings, Theme};
use crate::state::AppState;
use crate::ui::{MenuBar, Sidebar, StatusBar};

#[derive(Debug, Clone, PartialEq)]
pub enum ActivePage {
    KeyManage,      // å¯†é’¥ç®¡ç†
    KeyGenerate,    // å¯†é’¥ç”Ÿæˆ
    ImportExport,   // å¯¼å…¥å¯¼å‡º
    Settings,       // è®¾ç½®
    About,          // å…³äº
}

#[derive(Debug, Clone)]
pub enum Message {
    // å¯¼èˆªæ¶ˆæ¯
    NavigateToPage(ActivePage),

    // èœå•æ æ¶ˆæ¯
    MenuFileNew,
    MenuFileOpen,
    MenuFileSave,
    MenuFileExit,
    MenuEditCopy,
    MenuEditPaste,
    MenuViewRefresh,
    MenuHelpAbout,

    // ä¾§è¾¹æ æ¶ˆæ¯
    SidebarItemSelected(ActivePage),

    // é¡µé¢æ¶ˆæ¯
    KeyManageMessage(crate::ui::pages::key_manage::Message),
    KeyGenerateMessage(crate::ui::pages::key_generate::Message),
    ImportExportMessage(crate::ui::pages::import_export::Message),
    SettingsMessage(crate::ui::pages::settings::Message),

    // çŠ¶æ€æ æ¶ˆæ¯
    StatusUpdate(String),
    ConnectionStatusChanged(bool),

    // ç³»ç»Ÿæ¶ˆæ¯
    Tick,
    WindowResized,
}

pub struct EcipherApp {
    pub state: AppState,
    pub active_page: ActivePage,
    pub sidebar_width: f32,
    pub is_sidebar_collapsed: bool,
}

impl Application for EcipherApp {
    type Executor = iced::executor::Default;
    type Message = Message;
    type Theme = Theme;
    type Flags = ();

    fn new(_flags: ()) -> (Self, Command<Message>) {
        (
            Self {
                state: AppState::default(),
                active_page: ActivePage::KeyManage,
                sidebar_width: 250.0,
                is_sidebar_collapsed: false,
            },
            Command::none(),
        )
    }

    fn title(&self) -> String {
        let page_title = match self.active_page {
            ActivePage::KeyManage => "å¯†é’¥ç®¡ç†",
            ActivePage::KeyGenerate => "å¯†é’¥ç”Ÿæˆ",
            ActivePage::ImportExport => "å¯¼å…¥å¯¼å‡º",
            ActivePage::Settings => "è®¾ç½®",
            ActivePage::About => "å…³äº",
        };
        format!("ecipher - {}", page_title)
    }

    fn update(&mut self, message: Message) -> Command<Message> {
        match message {
            Message::NavigateToPage(page) => {
                self.active_page = page;
                Command::none()
            }
            Message::SidebarItemSelected(page) => {
                self.active_page = page;
                Command::perform(async {}, |_| Message::StatusUpdate(
                    format!("åˆ‡æ¢åˆ° {}", match page {
                        ActivePage::KeyManage => "å¯†é’¥ç®¡ç†",
                        ActivePage::KeyGenerate => "å¯†é’¥ç”Ÿæˆ", 
                        ActivePage::ImportExport => "å¯¼å…¥å¯¼å‡º",
                        ActivePage::Settings => "è®¾ç½®",
                        ActivePage::About => "å…³äº",
                    })
                ))
            }
            Message::StatusUpdate(status) => {
                self.state.status_message = Some(status);
                Command::none()
            }
            // å¤„ç†å…¶ä»–æ¶ˆæ¯...
            _ => Command::none(),
        }
    }

    fn view(&self) -> Element<Message> {
        let menu_bar = MenuBar::view(&self.state);

        let sidebar = Sidebar::view(
            &self.active_page, 
            self.sidebar_width,
            self.is_sidebar_collapsed
        );

        let body = self.render_body();

        let status_bar = StatusBar::view(&self.state);

        iced::widget::column![
            menu_bar,
            iced::widget::row![
                sidebar,
                body,
            ].height(iced::Length::Fill),
            status_bar,
        ]
        .height(iced::Length::Fill)
        .into()
    }
}

impl EcipherApp {
    fn render_body(&self) -> Element<Message> {
        use crate::ui::pages::*;

        match self.active_page {
            ActivePage::KeyManage => {
                key_manage::KeyManagePage::view(&self.state)
                    .map(Message::KeyManageMessage)
            }
            ActivePage::KeyGenerate => {
                key_generate::KeyGeneratePage::view(&self.state)
                    .map(Message::KeyGenerateMessage)
            }
            ActivePage::ImportExport => {
                import_export::ImportExportPage::view(&self.state)
                    .map(Message::ImportExportMessage)
            }
            ActivePage::Settings => {
                settings::SettingsPage::view(&self.state)
                    .map(Message::SettingsMessage)
            }
            ActivePage::About => {
                about::AboutPage::view(&self.state)
            }
        }
    }
}
```

### 2.2 èœå•æ ç»„ä»¶ (ui/components/menu_bar.rs)

```rust
use iced::{
    widget::{button, row, text, Space},
    Element, Length, Alignment,
};
use crate::{Message, state::AppState};

pub struct MenuBar;

#[derive(Debug, Clone)]
pub enum MenuAction {
    File(FileAction),
    Edit(EditAction),
    View(ViewAction),
    Help(HelpAction),
}

#[derive(Debug, Clone)]
pub enum FileAction {
    New,
    Open,
    Save,
    Export,
    Exit,
}

#[derive(Debug, Clone)]
pub enum EditAction {
    Copy,
    Paste,
    Delete,
    SelectAll,
}

#[derive(Debug, Clone)]
pub enum ViewAction {
    Refresh,
    ToggleSidebar,
    Fullscreen,
}

#[derive(Debug, Clone)]
pub enum HelpAction {
    Documentation,
    About,
}

impl MenuBar {
    pub fn view(state: &AppState) -> Element<Message> {
        let file_menu = Self::create_dropdown_menu("æ–‡ä»¶", vec![
            ("æ–°å»º", Message::MenuFileNew),
            ("æ‰“å¼€", Message::MenuFileOpen),
            ("ä¿å­˜", Message::MenuFileSave),
            ("å¯¼å‡º", Message::MenuFileExport),
            ("é€€å‡º", Message::MenuFileExit),
        ]);

        let edit_menu = Self::create_dropdown_menu("ç¼–è¾‘", vec![
            ("å¤åˆ¶", Message::MenuEditCopy),
            ("ç²˜è´´", Message::MenuEditPaste),
            ("åˆ é™¤", Message::MenuEditDelete),
            ("å…¨é€‰", Message::MenuEditSelectAll),
        ]);

        let view_menu = Self::create_dropdown_menu("è§†å›¾", vec![
            ("åˆ·æ–°", Message::MenuViewRefresh),
            ("åˆ‡æ¢ä¾§è¾¹æ ", Message::MenuViewToggleSidebar),
            ("å…¨å±", Message::MenuViewFullscreen),
        ]);

        let help_menu = Self::create_dropdown_menu("å¸®åŠ©", vec![
            ("æ–‡æ¡£", Message::MenuHelpDocumentation),
            ("å…³äº", Message::MenuHelpAbout),
        ]);

        let menu_row = row![
            file_menu,
            edit_menu,
            view_menu,
            Space::with_width(Length::Fill),
            // å³ä¾§æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
            Self::user_info_section(state),
            help_menu,
        ]
        .spacing(5)
        .align_items(Alignment::Center)
        .padding([8, 12]);

        iced::widget::container(menu_row)
            .width(Length::Fill)
            .style(iced::theme::Container::Custom(Box::new(MenuBarStyle)))
            .into()
    }

    fn create_dropdown_menu(label: &str, items: Vec<(&str, Message)>) -> Element<Message> {
        // ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…åº”è¯¥ä½¿ç”¨ä¸‹æ‹‰èœå•ç»„ä»¶
        button(text(label))
            .style(iced::theme::Button::Text)
            .on_press(items.first().map(|(_, msg)| msg.clone()).unwrap_or(Message::MenuFileNew))
            .into()
    }

    fn user_info_section(state: &AppState) -> Element<Message> {
        if let Some(ref user) = state.user {
            row![
                text("ç”¨æˆ·:").size(12),
                text(&user.display_name).size(12),
            ]
            .spacing(5)
            .align_items(Alignment::Center)
            .into()
        } else {
            text("æœªç™»å½•").size(12).into()
        }
    }
}

// èœå•æ æ ·å¼
struct MenuBarStyle;

impl iced::widget::container::StyleSheet for MenuBarStyle {
    type Style = iced::Theme;

    fn appearance(&self, _style: &Self::Style) -> iced::widget::container::Appearance {
        iced::widget::container::Appearance {
            background: Some(iced::Background::Color(iced::Color::from_rgb(0.95, 0.95, 0.95))),
            border: iced::Border {
                width: 0.0,
                color: iced::Color::TRANSPARENT,
                radius: 0.0.into(),
            },
            text_color: Some(iced::Color::BLACK),
            shadow: iced::Shadow::default(),
        }
    }
}
```

### 2.3 ä¾§è¾¹æ ç»„ä»¶ (ui/components/sidebar.rs)

```rust

pub struct Sidebar;

#[derive(Debug, Clone)]
pub struct SidebarItem {
    pub page: ActivePage,
    pub label: &'static str,
    pub icon: &'static str, // SVG å›¾æ ‡è·¯å¾„æˆ–å†…å®¹
    pub description: &'static str,
}

impl Sidebar {
    const SIDEBAR_ITEMS: &'static [SidebarItem] = &[
        SidebarItem {
            page: ActivePage::KeyManage,
            label: "å¯†é’¥ç®¡ç†",
            icon: "ğŸ”",
            description: "ç®¡ç†å’ŒæŸ¥çœ‹æ‰€æœ‰å¯†é’¥",
        },
        SidebarItem {
            page: ActivePage::KeyGenerate,
            label: "å¯†é’¥ç”Ÿæˆ",
            icon: "ğŸ²",
            description: "ç”Ÿæˆæ–°çš„å®‰å…¨å¯†é’¥",
        },
        SidebarItem {
            page: ActivePage::ImportExport,
            label: "å¯¼å…¥å¯¼å‡º",
            icon: "ğŸ“¤",
            description: "å¯¼å…¥å’Œå¯¼å‡ºå¯†é’¥æ–‡ä»¶",
        },
        SidebarItem {
            page: ActivePage::Settings,
            label: "è®¾ç½®",
            icon: "âš™ï¸",
            description: "åº”ç”¨ç¨‹åºè®¾ç½®",
        },
        SidebarItem {
            page: ActivePage::About,
            label: "å…³äº",
            icon: "â„¹ï¸",
            description: "å…³äº ecipher",
        },
    ];

    pub fn view(
        active_page: &ActivePage, 
        width: f32, 
        is_collapsed: bool
    ) -> Element<Message> {
        let mut sidebar_content = column![]
            .spacing(5)
            .padding(10);
    
        // æ ‡é¢˜åŒºåŸŸ
        let title_section = if is_collapsed {
            container(text("E").size(20).horizontal_alignment(iced::alignment::Horizontal::Center))
        } else {
            container(
                row![
                    text("ecipher").size(18),
                    Space::with_width(Length::Fill),
                    button("â‰¡")
                        .style(iced::theme::Button::Text)
                        .on_press(Message::MenuViewToggleSidebar)
                ]
                .align_items(Alignment::Center)
            )
        };
    
        sidebar_content = sidebar_content.push(title_section);
        sidebar_content = sidebar_content.push(Space::with_height(20));
    
        // å¯¼èˆªé¡¹ç›®
        for item in Self::SIDEBAR_ITEMS {
            let is_active = *active_page == item.page;
    
            let nav_item = if is_collapsed {
                // æŠ˜å çŠ¶æ€ï¼šåªæ˜¾ç¤ºå›¾æ ‡
                button(
                    container(text(item.icon).size(20))
                        .width(Length::Fill)
                        .center_x()
                )
                .width(Length::Fill)
                .style(if is_active {
                    iced::theme::Button::Primary
                } else {
                    iced::theme::Button::Secondary
                })
                .on_press(Message::SidebarItemSelected(item.page.clone()))
            } else {
                // å±•å¼€çŠ¶æ€ï¼šå›¾æ ‡ + æ–‡å­—
                button(
                    row![
                        container(text(item.icon).size(16))
                            .width(30)
                            .center_x(),
                        column![
                            text(item.label).size(14),
                            text(item.description).size(10)
                                .style(iced::theme::Text::Color(
                                    iced::Color::from_rgb(0.6, 0.6, 0.6)
                                ))
                        ]
                        .spacing(2)
                    ]
                    .align_items(Alignment::Center)
                    .spacing(10)
                )
                .width(Length::Fill)
                .padding([10, 15])
                .style(if is_active {
                    iced::theme::Button::Primary
                } else {
                    iced::theme::Button::Secondary
                })
                .on_press(Message::SidebarItemSelected(item.page.clone()))
            };
    
            sidebar_content = sidebar_content.push(nav_item);
        }
    
        // åº•éƒ¨åŒºåŸŸ
        sidebar_content = sidebar_content.push(Space::with_height(Length::Fill));
    
        if !is_collapsed {
            let footer = column![
                button("æŠ˜å ä¾§è¾¹æ ")
                    .style(iced::theme::Button::Text)
                    .on_press(Message::MenuViewToggleSidebar),
            ]
            .spacing(5);
    
            sidebar_content = sidebar_content.push(footer);
        }
    
        container(sidebar_content)
            .width(if is_collapsed { 60 } else { width })
            .height(Length::Fill)
            .style(iced::theme::Container::Custom(Box::new(SidebarStyle)))
            .into()
    }

}

// ä¾§è¾¹æ æ ·å¼
struct SidebarStyle;

impl iced::widget::container::StyleSheet for SidebarStyle {
    type Style = iced::Theme;

    fn appearance(&self, _style: &Self::Style) -> iced::widget::container::Appearance {
        iced::widget::container::Appearance {
            background: Some(iced::Background::Color(iced::Color::from_rgb(0.98, 0.98, 0.98))),
            border: iced::Border {
                width: 1.0,
                color: iced::Color::from_rgb(0.9, 0.9, 0.9),
                radius: 0.0.into(),
            },
            text_color: Some(iced::Color::BLACK),
            shadow: iced::Shadow {
                color: iced::Color::from_
       ```