### 密钥管理软件设计要点

#### 1. 项目结构设计
- **工作区结构**：采用Rust工作区(workspace)管理多模块，包含三个主要成员：
  - `shared`：共享库，包含数据模型、加密算法、网络协议等通用组件
  - `server`：服务端可执行程序，提供MySQL交互和API服务
  - `client`：客户端GUI应用，使用Iced或Egui框架

- **依赖共享**：通过`workspace.dependencies`统一管理公共依赖（如serde、tokio、sqlx等），确保版本一致性

#### 2. 技术选型
- **服务端**：
  - Web框架：Axum（轻量高效，支持异步）
  - 数据库连接：SQLx（类型安全，支持MySQL异步连接）
  - 加密库：ring（提供AES-GCM和HKDF实现）

- **客户端**：
  - GUI框架：Iced（跨平台支持好，声明式API）
  - 网络客户端：reqwest（TLS支持）
  - 本地存储：keyring-rs（系统原生密钥存储）

#### 3. 安全措施
- **数据传输**：
  - 强制TLSv1.2+加密连接
  - 服务器证书验证（ssl-mode=VERIFY_IDENTITY）
  - 配置示例：
    ```rust
    // 客户端连接配置
    let builder = MySqlPoolOptions::new()
        .ssl(Some(SslOptions::default().verify_server_cert(
            Path::new("ca-cert.pem"),
            Path::new("client-cert.pem"),
            Path::new("client-key.pem"),
        )));
    ```

- **密钥存储**：
  - 服务端：MySQL透明数据加密(TDE)
  - 客户端：使用keyring-rs存储主密钥，示例：
    ```rust
    let entry = Entry::new("key_manager", "user@example.com");
    entry.set_password(&master_key)?; // 存储加密后的主密钥
    ```

- **加密算法**：
  - 数据加密：AES-256-GCM（带12字节随机nonce）
  - 密钥派生：PBKDF2-HMAC-SHA256（100000次迭代）
  - 签名验证：Ed25519（用于验证服务端响应完整性）

#### 4. 数据库设计
- **表结构**：
  ```sql
  CREATE TABLE encrypted_keys (
      id INT PRIMARY KEY AUTO_INCREMENT,
      user_id VARCHAR(64) NOT NULL,
      key_name VARCHAR(64) NOT NULL,
      encrypted_data BLOB NOT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      updated_at TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
      UNIQUE KEY (user_id, key_name)
  );
  ```
- **索引优化**：复合索引(user_id, key_name)提升查询效率

#### 5. 跨平台兼容性
- **GUI渲染**：Iced支持Windows（DirectX）、macOS（Metal）、Linux（OpenGL）
- **构建配置**：
  - Windows：启用`winapi`特性，处理系统证书存储
  - macOS：链接Security.framework
  - Linux：依赖libsecret-1-dev